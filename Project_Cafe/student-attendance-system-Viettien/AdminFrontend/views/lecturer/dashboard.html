<div class="admin-layout">
    <!-- Sidebar -->
    <app-sidebar></app-sidebar>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button class="menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="page-title">Dashboard Giảng viên</h1>
            </div>
            
            <div class="header-right">
                <div class="user-info">
                    <div class="user-avatar" ng-click="openAvatarModal()">
                        <img ng-if="currentUser.avatarUrl" ng-src="{{currentUser.avatarUrl}}" alt="Avatar">
                        <span ng-if="!currentUser.avatarUrl">{{currentUser.fullName.charAt(0)}}</span>
                    </div>
                    <div class="user-details">
                        <span class="user-name">{{currentUser.fullName}}</span>
                        <span class="user-role">Giảng viên</span>
                    </div>
                </div>
                <button ng-click="logout()" class="btn btn-outline">
                    <i class="fas fa-sign-out-alt"></i> Đăng xuất
                </button>
            </div>
        </header>
        
        <!-- Content Body -->
        <div class="content-body">
            <!-- Statistics Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon blue">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <div class="stat-info">
                        <h3>{{stats.totalClasses || 0}}</h3>
                        <p>Lớp đang giảng dạy</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon green">
                        <i class="fas fa-user-graduate"></i>
                    </div>
                    <div class="stat-info">
                        <h3>{{stats.totalStudents || 0}}</h3>
                        <p>Tổng số sinh viên</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon orange">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="stat-info">
                        <h3>{{stats.todayClasses || 0}}</h3>
                        <p>Tiết học hôm nay</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon purple">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-info">
                        <h3>{{stats.warningStudents || 0}}</h3>
                        <p>SV cảnh báo chuyên cần</p>
                    </div>
                </div>
            </div>
            
            <!-- Today's Schedule -->
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-calendar-day"></i> Lịch giảng dạy hôm nay</h2>
                </div>
                <div class="card-body">
                    <div ng-if="loading" class="text-center">
                        <i class="fas fa-spinner fa-spin fa-2x"></i>
                        <p>Đang tải...</p>
                    </div>
                    
                    <div ng-if="!loading && todaySchedule.length === 0" class="text-center">
                        <i class="fas fa-calendar-times fa-3x" style="color: #94a3b8;"></i>
                        <p>Không có lịch giảng dạy hôm nay</p>
                    </div>
                    
                    <div ng-if="!loading && todaySchedule.length > 0" class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Tiết</th>
                                    <th>Môn học</th>
                                    <th>Lớp</th>
                                    <th>Phòng</th>
                                    <th>Thời gian</th>
                                    <th>Trạng thái</th>
                                    <th>Thao tác</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="schedule in todaySchedule">
                                    <td>{{schedule.period}}</td>
                                    <td><strong>{{schedule.subjectName}}</strong></td>
                                    <td>{{schedule.className}}</td>
                                    <td>{{schedule.room}}</td>
                                    <td>{{schedule.startTime}} - {{schedule.endTime}}</td>
                                    <td>
                                        <span class="badge" ng-class="{
                                            'badge-success': schedule.status === 'completed',
                                            'badge-warning': schedule.status === 'in_progress',
                                            'badge-secondary': schedule.status === 'pending'
                                        }">
                                            {{schedule.status === 'completed' ? 'Đã hoàn thành' : 
                                              schedule.status === 'in_progress' ? 'Đang diễn ra' : 'Chưa bắt đầu'}}
                                        </span>
                                    </td>
                                    <td>
                                        <a href="#!/lecturer/attendance/{{schedule.id}}" class="btn btn-sm btn-primary">
                                            <i class="fas fa-clipboard-check"></i> Điểm danh
                                        </a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-bolt"></i> Thao tác nhanh</h2>
                </div>
                <div class="card-body">
                    <div class="quick-actions">
                        <a href="#!/lecturer/attendance" class="quick-action-btn">
                            <i class="fas fa-clipboard-check"></i>
                            <span>Điểm danh lớp học</span>
                        </a>
                        <a href="#!/lecturer/grades" class="quick-action-btn">
                            <i class="fas fa-edit"></i>
                            <span>Nhập điểm</span>
                        </a>
                        <a href="#!/lecturer/schedule" class="quick-action-btn">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Xem lịch giảng dạy</span>
                        </a>
                        <a href="#!/lecturer/reports" class="quick-action-btn">
                            <i class="fas fa-chart-bar"></i>
                            <span>Báo cáo lớp học</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Avatar Change Modal -->
<div class="modal-overlay avatar-modal" ng-if="avatarModal.show" ng-click="closeAvatarModal()">
    <div class="modal" ng-click="$event.stopPropagation()">
        <div class="modal-header">
            <h3 class="modal-title"><i class="fas fa-user-circle"></i> Thay đổi ảnh đại diện</h3>
            <button class="modal-close" ng-click="closeAvatarModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="modal-body">
            <div class="avatar-preview-container">
                <div class="avatar-preview">
                    <img ng-if="avatarModal.previewUrl" ng-src="{{avatarModal.previewUrl}}" alt="Preview">
                    <div ng-if="!avatarModal.previewUrl" class="avatar-preview-placeholder">
                        <i class="fas fa-user"></i>
                        <span>{{currentUser.fullName.charAt(0)}}</span>
                    </div>
                </div>
            </div>
            
            <div class="avatar-upload-area">
                <div class="avatar-upload-dropzone" 
                     ng-click="triggerFileInput()"
                     ng-class="{'drag-over': avatarModal.dragOver}"
                     ng-drop="handleDrop($event)"
                     ng-dragover="handleDragOver($event)"
                     ng-dragleave="handleDragLeave($event)">
                    <div class="avatar-upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <div class="avatar-upload-text">
                        <strong>Nhấp để chọn file</strong> hoặc kéo thả vào đây
                        <br>
                        <small>Hỗ trợ: JPG, PNG, GIF (tối đa 5MB)</small>
                    </div>
                </div>
                
                <input type="file" 
                       id="avatarFileInput" 
                       accept="image/jpeg,image/png,image/gif" 
                       style="display: none;" 
                       onchange="angular.element(this).scope().handleFileSelect(this.files)">
                
                <div class="avatar-file-info" ng-if="avatarModal.selectedFile">
                    <i class="fas fa-check-circle"></i>
                    <div class="avatar-file-details">
                        <div class="avatar-file-name">{{avatarModal.selectedFile.name}}</div>
                        <div class="avatar-file-size">{{formatFileSize(avatarModal.selectedFile.size)}}</div>
                    </div>
                    <button class="btn-remove" ng-click="clearSelectedFile()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="avatar-error" ng-if="avatarModal.error">
                    <i class="fas fa-exclamation-circle"></i> {{avatarModal.error}}
                </div>
                
                <div class="avatar-success" ng-if="avatarModal.success">
                    <i class="fas fa-check-circle"></i> {{avatarModal.success}}
                </div>
            </div>
        </div>
        
        <div class="modal-footer">
            <button class="btn btn-outline" ng-click="closeAvatarModal()" ng-disabled="avatarModal.uploading">
                Hủy
            </button>
            <button class="btn btn-primary" 
                    ng-click="uploadAvatar()" 
                    ng-disabled="!avatarModal.selectedFile || avatarModal.uploading">
                <i class="fas fa-upload"></i> 
                <span ng-if="!avatarModal.uploading">Tải lên</span>
                <span ng-if="avatarModal.uploading">Đang tải...</span>
            </button>
        </div>
    </div>
</div>

