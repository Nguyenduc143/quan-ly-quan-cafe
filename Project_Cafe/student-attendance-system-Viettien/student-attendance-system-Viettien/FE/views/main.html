<div class="layout-container" ng-controller="MainController">

  <!-- ===================== SIDEBAR ===================== -->
  <aside 
    class="sidebar"
    ng-class="{
      'sidebar-open': sidebarOpen && !isMobile,
      'sidebar-collapsed': !sidebarOpen && !isMobile,
      'sidebar-mobile-open': sidebarOpen && isMobile,
      'sidebar-mobile-hidden': !sidebarOpen && isMobile
    }">

    <!-- ===== Logo / Brand ===== -->
    <div class="sidebar-header">
      <div class="brand">
        <i class="fa fa-graduation-cap"></i>
        <span ng-show="sidebarOpen || isMobile">EduSys</span>
      </div>
    </div>

    <!-- ===== Navigation Menu (DỮ LIỆU TỪ BE) ===== -->
    <nav class="sidebar-menu" ng-if="roleMenus.length > 0 && !menuLoading">
      <ul class="menu-list">

        <!-- Lặp qua danh sách menu từ BE -->
        <li ng-repeat="menu in roleMenus" 
            class="menu-item"
            ng-class="{'has-sub': menu.sub, 'open': activeMenu === menu.label}">

          <!-- Menu không có submenu -->
          <a ui-sref="{{menu.state}}" ui-sref-active="active" 
             class="menu-link" ng-if="!menu.sub">
            <i class="fa" ng-class="menu.icon"></i>
            <span ng-show="sidebarOpen || isMobile">{{ menu.label }}</span>
            <i class="fa fa-chevron-right arrow" style="visibility:hidden"></i>
          </a>

          <!-- Menu có submenu -->
          <a href="" class="menu-link" ng-if="menu.sub"
             ng-click="toggleSubmenu(menu.label)">
            <i class="fa" ng-class="menu.icon"></i>
            <span ng-show="sidebarOpen || isMobile">{{ menu.label }}</span>
            <i class="fa fa-chevron-right arrow" ng-class="{'rotate': activeMenu === menu.label}"></i>
          </a>

          <ul class="submenu" ng-if="menu.sub" ng-class="{'open': activeMenu === menu.label}">
            <li ng-repeat="sub in menu.sub">
              <a ui-sref="{{sub.state}}">
                <i class="fa fa-angle-right"></i> {{ sub.label }}
              </a>
            </li>
          </ul>

        </li>

      </ul>
    </nav>

    <!-- ===== Trạng thái loading ===== -->
    <div class="loading" ng-if="menuLoading">
      <i class="fa fa-spinner fa-spin"></i> Đang tải menu...
    </div>

    <!-- ===== Sidebar Footer ===== -->
    <div class="sidebar-footer">
      <div class="user-box" ui-sref="main.profile">
        <img ng-src="{{ avatarUrl || 'assets/img/default-avatar.png' }}" alt="avatar">
        <div class="user-info" ng-show="sidebarOpen || isMobile">
          <span class="name">{{ fullName }}</span>
          <span class="role">{{ role }}</span>
        </div>
      </div>

      <button ng-click="logout()" class="logout-btn">
        <i class="fa fa-sign-out-alt"></i>
        <span ng-show="sidebarOpen || isMobile">Đăng xuất</span>
      </button>
    </div>

  </aside>

  <!-- ===== Overlay cho mobile ===== -->
  <div class="overlay" 
       ng-show="isMobile && sidebarOpen" 
       ng-click="toggleSidebar()"></div>

  <!-- ===================== MAIN CONTENT ===================== -->
  <div class="main-content">

    <!-- ===== Topbar ===== -->
    <header class="topbar">
      <div class="topbar-left">
        <button class="menu-btn" ng-click="toggleSidebar()">
          <i class="fa fa-bars"></i>
        </button>
        <h1>Hệ thống quản lý sinh viên</h1>
      </div>

      <div class="topbar-actions">
        <button class="notification-btn">
          <i class="fa fa-bell"></i>
          <span class="badge">{{ notificationsCount || 0 }}</span>
        </button>
      </div>
    </header>

    <!-- ===== Nội dung trang chính ===== -->
    <main class="content-wrapper">
      <div ui-view></div>
    </main>

  </div>
</div>
