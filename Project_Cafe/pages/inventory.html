<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý Kho Nguyên liệu - Coffee Shop Management</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-coffee"></i>
                <h3>Coffee BOH</h3>
            </div>
            <nav class="sidebar-nav">
                <a href="../index.html" class="nav-item" id="navDashboard">
                    <i class="fas fa-chart-line"></i> <span>Dashboard</span>
                </a>
                <a href="menu.html" class="nav-item" id="navMenu">
                    <i class="fas fa-mug-hot"></i> <span>Quản lý Menu</span>
                </a>
                <a href="orders.html" class="nav-item" id="navOrders">
                    <i class="fas fa-shopping-cart"></i> <span>Đơn hàng</span>
                </a>
                <a href="tables.html" class="nav-item" id="navTables">
                    <i class="fas fa-table"></i> <span>Sơ đồ bàn</span>
                </a>
                <a href="inventory.html" class="nav-item active" id="navInventory">
                    <i class="fas fa-warehouse"></i> <span>Kho nguyên liệu</span>
                </a>
                <a href="employees.html" class="nav-item" id="navEmployees">
                    <i class="fas fa-users"></i> <span>Nhân viên</span>
                </a>
                <a href="reports.html" class="nav-item" id="navReports">
                    <i class="fas fa-file-alt"></i> <span>Báo cáo</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <div class="user-info">
                    <i class="fas fa-user-circle"></i>
                    <span id="currentUser">Quản trị viên</span>
                </div>
                <button id="logoutBtn" class="btn btn-secondary">
                    <i class="fas fa-sign-out-alt"></i> Đăng xuất
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <button id="toggleSidebar" class="btn-icon">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1>
                        Quản lý Kho Nguyên liệu
                    </h1>
                </div>
                <div class="header-right">
                    <button class="btn-icon" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </header>
            <!-- Tabs -->
            <div class="tabs-container">
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab('materials')">
                        <i class="fas fa-boxes"></i> Nguyên liệu
                    </button>
                    <button class="tab-btn" onclick="switchTab('suppliers')">
                        <i class="fas fa-truck"></i> Nhà cung cấp
                    </button>
                    <button class="tab-btn" onclick="switchTab('purchases')">
                        <i class="fas fa-file-invoice"></i> Hóa đơn nhập
                    </button>
                </div>
            </div>

            <!-- Materials Tab -->
            <div id="materialsTab" class="tab-content active">
                <!-- Statistics -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-boxes stat-icon" style="color: #007bff;"></i>
                        <div class="stat-details">
                            <h3 id="totalMaterials">0</h3>
                            <p>Tổng nguyên liệu</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-dollar-sign stat-icon" style="color: #28a745;"></i>
                        <div class="stat-details">
                            <h3 id="totalInventoryValue">0đ</h3>
                            <p>Giá trị kho</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-exclamation-triangle stat-icon" style="color: #ffc107;"></i>
                        <div class="stat-details">
                            <h3 id="lowStockCount">0</h3>
                            <p>Sắp hết hàng</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-times-circle stat-icon" style="color: #dc3545;"></i>
                        <div class="stat-details">
                            <h3 id="outOfStockCount">0</h3>
                            <p>Hết hàng</p>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="actions">
                    <div class="search-filter" style="margin-left:20px;">
                        <input type="text" id="searchMaterial" placeholder="Tìm kiếm nguyên liệu..." onkeyup="filterMaterials()">
                        <select id="filterStock" style="width:auto;" onchange="filterMaterials()">
                            <option value="all">Tất cả trạng thái</option>
                            <option value="in-stock">Còn hàng</option>
                            <option value="low-stock">Sắp hết</option>
                            <option value="out-of-stock">Hết hàng</option>
                        </select>
                        <button class="btn btn-primary" onclick="openMaterialModal()">
                            <i class="fas fa-plus"></i> Thêm nguyên liệu
                        </button>
                    </div>
                </div>

                <!-- Materials Table -->
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Mã NL</th>
                                <th>Tên nguyên liệu</th>
                                <th>Đơn vị</th>
                                <th>Số lượng tồn</th>
                                <th>Tồn tối thiểu</th>
                                <th>Giá nhập</th>
                                <th>Trạng thái</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="materialsTableBody">
                            <tr>
                                <td colspan="8" style="text-align: center;">Chưa có nguyên liệu nào</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Suppliers Tab -->
            <div id="suppliersTab" class="tab-content">
                <!-- Suppliers Stats -->
                <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
                    <div class="stat-card">
                        <i class="fas fa-truck stat-icon" style="color: #007bff;"></i>
                        <div class="stat-details">
                            <h3 id="totalSuppliers">0</h3>
                            <p>Tổng nhà cung cấp</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-check-circle stat-icon" style="color: #28a745;"></i>
                        <div class="stat-details">
                            <h3 id="activeSuppliers">0</h3>
                            <p>Đang hợp tác</p>
                        </div>
                    </div>
                </div>

                <!-- Suppliers Actions -->
                <div class="actions">
                    <button class="btn btn-primary" onclick="openSupplierModal()">
                        <i class="fas fa-plus"></i> Thêm nhà cung cấp
                    </button>
                    <input type="text" id="searchSupplier" placeholder="Tìm kiếm nhà cung cấp..." onkeyup="filterSuppliers()">
                </div>

                <!-- Suppliers Table -->
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Mã NCC</th>
                                <th>Tên nhà cung cấp</th>
                                <th>Liên hệ</th>
                                <th>Địa chỉ</th>
                                <th>Email</th>
                                <th>Trạng thái</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="suppliersTableBody">
                            <tr>
                                <td colspan="7" style="text-align: center;">Chưa có nhà cung cấp nào</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Purchases Tab -->
            <div id="purchasesTab" class="tab-content">
                <!-- Purchases Stats -->
                <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
                    <div class="stat-card">
                        <i class="fas fa-file-invoice stat-icon" style="color: #007bff;"></i>
                        <div class="stat-details">
                            <h3 id="totalPurchases">0</h3>
                            <p>Tổng hóa đơn</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-dollar-sign stat-icon" style="color: #28a745;"></i>
                        <div class="stat-details">
                            <h3 id="totalPurchaseValue">0đ</h3>
                            <p>Tổng giá trị nhập</p>
                        </div>
                    </div>
                </div>

                <!-- Purchases Actions -->
                <div class="actions">
                    <div class="search-filter">
                        <input type="text" id="searchPurchase" placeholder="Tìm kiếm hóa đơn..." onkeyup="filterPurchases()">
                        <input type="date" id="filterPurchaseDate" onchange="filterPurchases()">
                        <button class="btn btn-primary" onclick="openPurchaseModal()">
                            <i class="fas fa-plus"></i> Tạo hóa đơn nhập
                        </button>
                    </div>
                </div>

                <!-- Purchases Table -->
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Mã HĐ</th>
                                <th>Ngày nhập</th>
                                <th>Nhà cung cấp</th>
                                <th>Số mặt hàng</th>
                                <th>Tổng tiền</th>
                                <th>Người nhập</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="purchasesTableBody">
                            <tr>
                                <td colspan="7" style="text-align: center;">Chưa có hóa đơn nhập nào</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Material Modal -->
    <div id="materialModal" class="modal">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeMaterialModal()">
                <i class="fas fa-times"></i>
            </button>
            <div class="modal-header">
                <h2 id="materialModalTitle">Thêm nguyên liệu</h2>
            </div>
            <form id="materialForm" onsubmit="saveMaterial(event)">
                <div class="form-group">
                    <label>Tên nguyên liệu <span style="color: red;">*</span></label>
                    <input type="text" id="materialName" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Đơn vị <span style="color: red;">*</span></label>
                        <select id="materialUnit" required>
                            <option value="">Chọn đơn vị</option>
                            <option value="kg">kg</option>
                            <option value="g">g</option>
                            <option value="lít">lít</option>
                            <option value="ml">ml</option>
                            <option value="hộp">hộp</option>
                            <option value="gói">gói</option>
                            <option value="chai">chai</option>
                            <option value="lon">lon</option>
                            <option value="túi">túi</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Số lượng tồn kho <span style="color: red;">*</span></label>
                        <input type="number" id="materialStock" min="0" step="0.01" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Tồn tối thiểu <span style="color: red;">*</span></label>
                        <input type="number" id="materialMinStock" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Giá nhập (VNĐ) <span style="color: red;">*</span></label>
                        <input type="number" id="materialPrice" min="0" step="1000" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Ghi chú</label>
                    <textarea id="materialNote" rows="3"></textarea>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-secondary" onclick="closeMaterialModal()">Hủy</button>
                    <button type="submit" class="btn btn-success">Lưu</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Supplier Modal -->
    <div id="supplierModal" class="modal">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeSupplierModal()">
                <i class="fas fa-times"></i>
            </button>
            <div class="modal-header">
                <h2 id="supplierModalTitle">Thêm nhà cung cấp</h2>
            </div>
            <form id="supplierForm" onsubmit="saveSupplier(event)">
                <div class="form-group">
                    <label>Tên nhà cung cấp <span style="color: red;">*</span></label>
                    <input type="text" id="supplierName" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Số điện thoại <span style="color: red;">*</span></label>
                        <input type="tel" id="supplierPhone" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="supplierEmail">
                    </div>
                </div>
                <div class="form-group">
                    <label>Địa chỉ <span style="color: red;">*</span></label>
                    <input type="text" id="supplierAddress" required>
                </div>
                <div class="form-group">
                    <label>Người liên hệ</label>
                    <input type="text" id="supplierContact">
                </div>
                <div class="form-group">
                    <label>Ghi chú</label>
                    <textarea id="supplierNote" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="supplierActive" checked>
                        Đang hợp tác
                    </label>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-secondary" onclick="closeSupplierModal()">Hủy</button>
                    <button type="submit" class="btn btn-success">Lưu</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Purchase Modal -->
    <div id="purchaseModal" class="modal">
        <div class="modal-content modal-large">
            <button class="modal-close-btn" onclick="closePurchaseModal()">
                <i class="fas fa-times"></i>
            </button>
            <div class="modal-header">
                <h2 id="purchaseModalTitle">Tạo hóa đơn nhập</h2>
            </div>
            <form id="purchaseForm" onsubmit="savePurchase(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>Nhà cung cấp <span style="color: red;">*</span></label>
                        <select id="purchaseSupplier" required>
                            <option value="">Chọn nhà cung cấp</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ngày nhập <span style="color: red;">*</span></label>
                        <input type="date" id="purchaseDate" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Người nhập <span style="color: red;">*</span></label>
                    <input type="text" id="purchaseEmployee" required>
                </div>
                
                <h3 style="margin-top: 1.5rem; margin-bottom: 1rem;">Nguyên liệu nhập</h3>
                
                <div class="form-row">
                    <div class="form-group" style="flex: 2;">
                        <label>Chọn nguyên liệu</label>
                        <select id="selectMaterial">
                            <option value="">-- Chọn nguyên liệu --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Số lượng</label>
                        <input type="number" id="materialQuantity" min="0.01" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Giá nhập</label>
                        <input type="number" id="materialPurchasePrice" min="0" step="1000">
                    </div>
                    <div class="form-group" style="align-self: flex-end;">
                        <button type="button" class="btn btn-success" onclick="addMaterialToPurchase()">
                            <i class="fas fa-plus"></i> Thêm
                        </button>
                    </div>
                </div>

                <div class="table-container" style="margin-top: 1rem;">
                    <table id="purchaseItemsTable">
                        <thead>
                            <tr>
                                <th>Nguyên liệu</th>
                                <th>Đơn vị</th>
                                <th>Số lượng</th>
                                <th>Giá nhập</th>
                                <th>Thành tiền</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="purchaseItemsBody">
                            <tr>
                                <td colspan="6" style="text-align: center;">Chưa có nguyên liệu nào</td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="4" style="text-align: right;"><strong>Tổng cộng:</strong></td>
                                <td colspan="2"><strong id="purchaseTotal">0đ</strong></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <div class="form-group">
                    <label>Ghi chú</label>
                    <textarea id="purchaseNote" rows="3"></textarea>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-secondary" onclick="closePurchaseModal()">Hủy</button>
                    <button type="submit" class="btn btn-success">Lưu hóa đơn</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Purchase Detail Modal -->
    <div id="purchaseDetailModal" class="modal">
        <div class="modal-content modal-large">
            <button class="modal-close-btn" onclick="closePurchaseDetailModal()">
                <i class="fas fa-times"></i>
            </button>
            <div class="modal-header">
                <h2>Chi tiết hóa đơn nhập</h2>
            </div>
            <div id="purchaseDetailContent"></div>
        </div>
    </div>

    <script src="../js/utils.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/inventory.js"></script>
    <script src="../js/app.js"></script>
</body>
</html>
