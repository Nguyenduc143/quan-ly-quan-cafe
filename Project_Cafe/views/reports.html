<!-- Reports View -->
<div class="dashboard-wrapper" ng-controller="ReportsController as vm">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-brand">
            <i class="fas fa-coffee"></i>
            <h2>Coffee BOH</h2>
        </div>
        
        <nav class="sidebar-menu">
            <a href="#!/dashboard" class="menu-item">
                <i class="fas fa-chart-line"></i>
                <span>Dashboard</span>
            </a>
            <a href="#!/menu" class="menu-item">
                <i class="fas fa-mug-hot"></i>
                <span>Quản lý Menu</span>
            </a>
            <a href="#!/orders" class="menu-item">
                <i class="fas fa-shopping-cart"></i>
                <span>Đơn hàng</span>
            </a>
            <a href="#!/tables" class="menu-item">
                <i class="fas fa-table"></i>
                <span>Sơ đồ bàn</span>
            </a>
            <a href="#!/inventory" class="menu-item">
                <i class="fas fa-warehouse"></i>
                <span>Kho nguyên liệu</span>
            </a>
            <a href="#!/employees" class="menu-item" ng-if="currentUser.role === 'Quản lý'">
                <i class="fas fa-users"></i>
                <span>Nhân viên</span>
            </a>
            <a href="#!/reports" class="menu-item active">
                <i class="fas fa-file-alt"></i>
                <span>Báo cáo</span>
            </a>
        </nav>
        
        <div class="sidebar-bottom">
            <div class="user-profile">
                <i class="fas fa-user-circle"></i>
                <div style="display: flex; flex-direction: column; gap: 2px;">
                    <span style="font-weight: 600;" title="{{ vm.currentUser.username }}">{{ vm.currentUser.name || 'User' }}</span>
                    <span style="font-size: 11px; color: #95a5a6;">{{ vm.currentUser.role || 'Nhân viên' }}</span>
                </div>
            </div>
            <button ng-click="vm.logout()" class="btn-logout">
                <i class="fas fa-sign-out-alt"></i>
                <span>Đăng xuất</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-area">
        <!-- Header -->
        <header class="top-header">
            <div class="header-left">
                <button ng-click="vm.toggleSidebar()" class="btn-menu">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="page-title">Báo cáo & Thống kê</h1>
            </div>
            <div class="header-right">
                <button ng-click="vm.toggleTheme()" class="btn-theme">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </header>

        <!-- Dashboard Content -->
        <div class="content-area">
            <!-- Date Range Filter -->
            <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 20px;">
                <div style="display: flex; gap: 15px; align-items: flex-end;">
                    <div style="flex: 1;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50; font-size: 14px;">Từ ngày</label>
                        <input 
                            type="date" 
                            ng-model="vm.startDate"
                            style="width: 100%; padding: 12px 16px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 14px;"
                            onfocus="this.style.borderColor='#3498db'"
                            onblur="this.style.borderColor='#e0e0e0'">
                    </div>
                    <div style="flex: 1;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50; font-size: 14px;">Đến ngày</label>
                        <input 
                            type="date" 
                            ng-model="vm.endDate"
                            style="width: 100%; padding: 12px 16px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 14px;"
                            onfocus="this.style.borderColor='#3498db'"
                            onblur="this.style.borderColor='#e0e0e0'">
                    </div>
                    <button ng-click="vm.generateReport()" style="padding: 12px 32px; background: #3498db; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.3s;"
                        onmouseover="this.style.background='#2980b9'; this.style.transform='translateY(-1px)'"
                        onmouseout="this.style.background='#3498db'; this.style.transform='translateY(0)'">
                        <i class="fas fa-file-alt"></i> Tạo báo cáo
                    </button>
                </div>
            </div>

            <!-- Statistics Cards -->
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px;">
                <!-- Tổng doanh thu -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); color: white;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="width: 60px; height: 60px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-dollar-sign" style="font-size: 28px;"></i>
                        </div>
                        <div>
                            <p style="margin: 0; font-size: 14px; opacity: 0.9;">Tổng doanh thu</p>
                            <h2 style="margin: 5px 0 0 0; font-size: 32px; font-weight: 700;">{{vm.reportData.totalRevenue | number:0}} đ</h2>
                        </div>
                    </div>
                </div>

                <!-- Tổng đơn hàng -->
                <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 12px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); color: white;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="width: 60px; height: 60px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-shopping-cart" style="font-size: 28px;"></i>
                        </div>
                        <div>
                            <p style="margin: 0; font-size: 14px; opacity: 0.9;">Tổng đơn hàng</p>
                            <h2 style="margin: 5px 0 0 0; font-size: 32px; font-weight: 700;">{{vm.reportData.totalOrders | number:0}}</h2>
                        </div>
                    </div>
                </div>

                <!-- Trung bình/đơn -->
                <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 12px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); color: white;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="width: 60px; height: 60px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-chart-line" style="font-size: 28px;"></i>
                        </div>
                        <div>
                            <p style="margin: 0; font-size: 14px; opacity: 0.9;">Trung bình/đơn</p>
                            <h2 style="margin: 5px 0 0 0; font-size: 32px; font-weight: 700;">{{vm.reportData.avgOrder | number:0}} đ</h2>
                        </div>
                    </div>
                </div>

                <!-- Doanh thu thuần -->
                <div style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); border-radius: 12px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); color: white;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="width: 60px; height: 60px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-hand-holding-usd" style="font-size: 28px;"></i>
                        </div>
                        <div>
                            <p style="margin: 0; font-size: 14px; opacity: 0.9;">Doanh thu thuần</p>
                            <h2 style="margin: 5px 0 0 0; font-size: 32px; font-weight: 700;">{{vm.reportData.netRevenue | number:0}} đ</h2>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Top Products Table -->
            <div style="background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); overflow: hidden;">
                <div style="padding: 20px; border-bottom: 1px solid #ecf0f1; display: flex; justify-content: space-between; align-items: center;">
                    <h2 style="margin: 0; font-size: 18px; font-weight: 600; color: #2c3e50; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-chart-pie" style="color: #3498db;"></i>
                        Top 5 sản phẩm bán chạy
                    </h2>
                    <div style="display: flex; gap: 10px;">
                        <button ng-click="vm.exportReport('csv')" style="padding: 8px 16px; background: #27ae60; color: white; border: none; border-radius: 8px; font-size: 14px; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-file-csv"></i> CSV
                        </button>
                        <button ng-click="vm.exportReport('excel')" style="padding: 8px 16px; background: #2ecc71; color: white; border: none; border-radius: 8px; font-size: 14px; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-file-excel"></i> Excel
                        </button>
                        <button ng-click="vm.exportReport('pdf')" style="padding: 8px 16px; background: #e74c3c; color: white; border: none; border-radius: 8px; font-size: 14px; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-file-pdf"></i> PDF
                        </button>
                    </div>
                </div>

                <div ng-if="vm.isLoading" style="text-align: center; padding: 80px 20px;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 48px; color: #3498db;"></i>
                    <p style="margin-top: 20px; color: #7f8c8d; font-size: 15px;">Đang tải dữ liệu...</p>
                </div>

                <div ng-if="!vm.isLoading && vm.topProducts.length === 0" style="text-align: center; padding: 80px 20px;">
                    <i class="fas fa-chart-bar" style="font-size: 64px; color: #dfe6e9;"></i>
                    <p style="margin-top: 20px; color: #95a5a6; font-size: 16px; font-style: italic;">Chưa có dữ liệu</p>
                </div>

                <table ng-if="!vm.isLoading && vm.topProducts.length > 0" style="width: 100%; border-collapse: collapse;">
                    <thead style="background: #f8f9fa; border-bottom: 2px solid #ecf0f1;">
                        <tr>
                            <th style="padding: 16px 20px; text-align: left; font-weight: 600; color: #6c757d; font-size: 13px; text-transform: uppercase;">#</th>
                            <th style="padding: 16px 20px; text-align: left; font-weight: 600; color: #6c757d; font-size: 13px; text-transform: uppercase;">Sản phẩm</th>
                            <th style="padding: 16px 20px; text-align: right; font-weight: 600; color: #6c757d; font-size: 13px; text-transform: uppercase;">Đơn giá</th>
                            <th style="padding: 16px 20px; text-align: right; font-weight: 600; color: #6c757d; font-size: 13px; text-transform: uppercase;">Số lượng</th>
                            <th style="padding: 16px 20px; text-align: right; font-weight: 600; color: #6c757d; font-size: 13px; text-transform: uppercase;">Doanh thu</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="product in vm.topProducts" style="border-bottom: 1px solid #f1f3f5; transition: background 0.2s;"
                            onmouseover="this.style.background='#f8f9fa'"
                            onmouseout="this.style.background='white'">
                            <td style="padding: 16px 20px; color: #2c3e50; font-weight: 600; font-size: 14px;">{{ $index + 1 }}</td>
                            <td style="padding: 16px 20px; color: #2c3e50; font-weight: 500; font-size: 14px;">{{ product.name }}</td>
                            <td style="padding: 16px 20px; color: #6c757d; font-size: 14px; text-align: right;">{{ product.price | number:0 }} đ</td>
                            <td style="padding: 16px 20px; color: #6c757d; font-size: 14px; text-align: right;">{{ product.quantity | number:0 }}</td>
                            <td style="padding: 16px 20px; color: #27ae60; font-size: 14px; font-weight: 600; text-align: right;">{{ product.revenue | number:0 }} đ</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>
</div>
        <div ng-show="vm.reportType === 'products'" class="report-content">
            <div ng-if="vm.productData">
                <!-- Product Statistics -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #e3f2fd;">
                            <i class="fas fa-mug-hot" style="color: #2196f3;"></i>
                        </div>
                        <div class="stat-details">
                            <h3>{{ vm.productData.totalProducts }}</h3>
                            <p>Tổng sản phẩm</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #e8f5e9;">
                            <i class="fas fa-shopping-bag" style="color: #4caf50;"></i>
                        </div>
                        <div class="stat-details">
                            <h3>{{ vm.productData.totalSold }}</h3>
                            <p>Đã bán</p>
                        </div>
                    </div>
                </div>

                <!-- Top Selling Products -->
                <div class="card">
                    <div class="card-header">
                        <h3>Sản phẩm bán chạy nhất</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>STT</th>
                                        <th>Tên sản phẩm</th>
                                        <th>Danh mục</th>
                                        <th>Số lượng bán</th>
                                        <th>Doanh thu</th>
                                        <th>% Tổng doanh thu</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="product in vm.productData.topSellingProducts">
                                        <td>{{ $index + 1 }}</td>
                                        <td>{{ product.name }}</td>
                                        <td>{{ product.category }}</td>
                                        <td>{{ product.quantitySold }}</td>
                                        <td>{{ product.revenue | number:0 }}đ</td>
                                        <td>{{ product.percentOfTotal | number:1 }}%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Category Breakdown -->
                <div class="card">
                    <div class="card-header">
                        <h3>Phân tích theo danh mục</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Danh mục</th>
                                        <th>Số lượng</th>
                                        <th>Doanh thu</th>
                                        <th>% Tổng doanh thu</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="category in vm.productData.categoryBreakdown">
                                        <td>{{ category.category }}</td>
                                        <td>{{ category.quantity }}</td>
                                        <td>{{ category.revenue | number:0 }}đ</td>
                                        <td>{{ category.percent | number:1 }}%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Employee Report -->
        <div ng-show="vm.reportType === 'employees'" class="report-content">
            <div ng-if="vm.employeeData">
                <!-- Employee Statistics -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #e3f2fd;">
                            <i class="fas fa-users" style="color: #2196f3;"></i>
                        </div>
                        <div class="stat-details">
                            <h3>{{ vm.employeeData.totalEmployees }}</h3>
                            <p>Tổng nhân viên</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #e8f5e9;">
                            <i class="fas fa-user-check" style="color: #4caf50;"></i>
                        </div>
                        <div class="stat-details">
                            <h3>{{ vm.employeeData.activeEmployees }}</h3>
                            <p>Đang hoạt động</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #fff3e0;">
                            <i class="fas fa-clipboard-list" style="color: #ff9800;"></i>
                        </div>
                        <div class="stat-details">
                            <h3>{{ vm.employeeData.totalOrders }}</h3>
                            <p>Đơn đã xử lý</p>
                        </div>
                    </div>
                </div>

                <!-- Employee Performance -->
                <div class="card">
                    <div class="card-header">
                        <h3>Hiệu suất nhân viên</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>STT</th>
                                        <th>Tên nhân viên</th>
                                        <th>Chức vụ</th>
                                        <th>Đơn xử lý</th>
                                        <th>Doanh thu</th>
                                        <th>TB/đơn</th>
                                        <th>Đánh giá</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="emp in vm.employeeData.employeePerformance">
                                        <td>{{ $index + 1 }}</td>
                                        <td>{{ emp.name }}</td>
                                        <td>{{ emp.role }}</td>
                                        <td>{{ emp.ordersProcessed }}</td>
                                        <td>{{ emp.revenue > 0 ? (emp.revenue | number:0) + 'đ' : '-' }}</td>
                                        <td>{{ emp.averageOrderValue > 0 ? (emp.averageOrderValue | number:0) + 'đ' : '-' }}</td>
                                        <td>
                                            <span class="rating">
                                                <i class="fas fa-star"></i> {{ emp.rating }}
                                            </span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Inventory Report -->
        <div ng-show="vm.reportType === 'inventory'" class="report-content">
            <div ng-if="vm.inventoryData">
                <!-- Inventory Statistics -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #e3f2fd;">
                            <i class="fas fa-boxes" style="color: #2196f3;"></i>
                        </div>
                        <div class="stat-details">
                            <h3>{{ vm.inventoryData.totalMaterials }}</h3>
                            <p>Tổng nguyên liệu</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #fff3e0;">
                            <i class="fas fa-exclamation-triangle" style="color: #ff9800;"></i>
                        </div>
                        <div class="stat-details">
                            <h3>{{ vm.inventoryData.lowStockItems }}</h3>
                            <p>Sắp hết hàng</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #e8f5e9;">
                            <i class="fas fa-dollar-sign" style="color: #4caf50;"></i>
                        </div>
                        <div class="stat-details">
                            <h3>{{ vm.inventoryData.totalValue | number:0 }}đ</h3>
                            <p>Tổng giá trị kho</p>
                        </div>
                    </div>
                </div>

                <!-- Material Status -->
                <div class="card">
                    <div class="card-header">
                        <h3>Tình trạng nguyên liệu</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>STT</th>
                                        <th>Tên nguyên liệu</th>
                                        <th>Số lượng</th>
                                        <th>Tồn tối thiểu</th>
                                        <th>Trạng thái</th>
                                        <th>Giá trị</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="material in vm.inventoryData.materials">
                                        <td>{{ $index + 1 }}</td>
                                        <td>{{ material.name }}</td>
                                        <td>{{ material.quantity }} {{ material.unit }}</td>
                                        <td>{{ material.minQuantity }} {{ material.unit }}</td>
                                        <td>
                                            <span class="badge" ng-class="{
                                                'badge-success': material.status === 'sufficient',
                                                'badge-warning': material.status === 'low',
                                                'badge-danger': material.status === 'out'
                                            }">
                                                {{ material.status === 'sufficient' ? 'Đủ hàng' : (material.status === 'low' ? 'Sắp hết' : 'Hết hàng') }}
                                            </span>
                                        </td>
                                        <td>{{ material.value | number:0 }}đ</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Recent Purchases -->
                <div class="card">
                    <div class="card-header">
                        <h3>Đơn nhập hàng gần đây</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Mã ĐH</th>
                                        <th>Ngày nhập</th>
                                        <th>Nhà cung cấp</th>
                                        <th>Số mặt hàng</th>
                                        <th>Tổng tiền</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="purchase in vm.inventoryData.recentPurchases">
                                        <td>#{{ purchase.id }}</td>
                                        <td>{{ purchase.date | date:'dd/MM/yyyy' }}</td>
                                        <td>{{ purchase.supplier }}</td>
                                        <td>{{ purchase.items }}</td>
                                        <td>{{ purchase.amount | number:0 }}đ</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<style>
.filter-bar {
    background: white;
    padding: 15px 20px;
    margin-bottom: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.filter-group {
    display: flex;
    align-items: center;
    gap: 15px;
    flex-wrap: wrap;
}

.filter-group label {
    font-weight: 600;
    color: #333;
}

.date-range-inputs {
    display: flex;
    align-items: center;
    gap: 10px;
}

.card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    margin-bottom: 20px;
}

.card-header {
    padding: 15px 20px;
    border-bottom: 1px solid #e0e0e0;
}

.card-header h3 {
    margin: 0;
    font-size: 18px;
    color: #333;
}

.card-body {
    padding: 20px;
}

.rating {
    color: #ff9800;
    font-weight: 600;
}

.header-actions {
    display: flex;
    gap: 10px;
}
</style>
