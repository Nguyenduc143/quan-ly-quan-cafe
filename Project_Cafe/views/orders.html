<!-- Orders Management View -->
<div class="dashboard-wrapper" ng-controller="OrdersController as vm">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <i class="fas fa-coffee"></i>
            <h3>Coffee BOH</h3>
        </div>
        <nav class="sidebar-nav">
            <a href="#!/dashboard" class="nav-item">
                <i class="fas fa-chart-line"></i> <span>Dashboard</span>
            </a>
            <a href="#!/menu" class="nav-item">
                <i class="fas fa-mug-hot"></i> <span>Qu·∫£n l√Ω Menu</span>
            </a>
            <a href="#!/orders" class="nav-item active">
                <i class="fas fa-shopping-cart"></i> <span>ƒê∆°n h√†ng</span>
            </a>
            <a href="#!/tables" class="nav-item">
                <i class="fas fa-table"></i> <span>S∆° ƒë·ªì b√†n</span>
            </a>
            <a href="#!/inventory" class="nav-item">
                <i class="fas fa-warehouse"></i> <span>Kho nguy√™n li·ªáu</span>
            </a>
            <a href="#!/employees" class="nav-item" ng-if="currentUser.role === 'Qu·∫£n l√Ω'">
                <i class="fas fa-users"></i> <span>Nh√¢n vi√™n</span>
            </a>
            <a href="#!/reports" class="nav-item">
                <i class="fas fa-file-alt"></i> <span>B√°o c√°o</span>
            </a>
        </nav>
        <div class="sidebar-footer">
            <div class="user-info">
                <i class="fas fa-user-circle"></i>
                <div style="display: flex; flex-direction: column; gap: 2px;">
                    <span style="font-weight: 600;" title="{{ vm.currentUser.username }}">{{ vm.currentUser.name || 'User' }}</span>
                    <span style="font-size: 11px; opacity: 0.7;">{{ vm.currentUser.role || 'Nh√¢n vi√™n' }}</span>
                </div>
            </div>
            <button ng-click="vm.logout()" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-area">
        <!-- Header -->
        <header class="top-header">
            <div class="header-left">
                <button class="btn-menu">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="page-title">Qu·∫£n l√Ω ƒê∆°n h√†ng</h1>
            </div>
            <div class="header-right">
                <button ng-click="vm.toggleTheme()" class="btn-theme">
                    <i class="fas fa-moon"></i>
                </button>
                <span class="current-time">{{ vm.currentDateTime }}</span>
            </div>
        </header>

        <!-- Orders Content -->
        <div class="content-area">
            <!-- Toolbar -->
            <div class="content-card" style="margin-bottom: 25px;">
                <div class="card-content">
                    <div style="display: grid; grid-template-columns: 2fr 1fr auto; gap: 15px; align-items: center;">
                        <!-- Search Box -->
                        <div style="position: relative;">
                            <i class="fas fa-search" style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #7f8c8d; z-index: 1;"></i>
                            <input 
                                type="text" 
                                ng-model="vm.searchTerm" 
                                ng-change="vm.filterOrders()"
                                placeholder="T√¨m ki·∫øm ƒë∆°n h√†ng theo ID ho·∫∑c b√†n..."
                                style="width: 100%; padding: 12px 15px 12px 45px; border: 1px solid #ecf0f1; border-radius: 8px; font-size: 14px;">
                        </div>
                        
                        <!-- Status Filter -->
                        <select 
                            ng-model="vm.selectedStatus" 
                            ng-change="vm.filterOrders()"
                            style="padding: 12px 15px; border: 1px solid #ecf0f1; border-radius: 8px; font-size: 14px; width: 100%;">
                            <option value="all">üìã T·∫•t c·∫£ tr·∫°ng th√°i</option>
                            <option value="0">‚è≥ Ch∆∞a thanh to√°n</option>
                            <option value="1">‚úÖ ƒê√£ thanh to√°n</option>
                        </select>
                        
                        <!-- Add Button -->
                        <button ng-click="vm.openOrderModal()" class="btn btn-primary" style="white-space: nowrap; padding: 12px 24px;">
                            <i class="fas fa-plus"></i> T·∫°o ƒë∆°n m·ªõi
                        </button>
                    </div>
                </div>
            </div>

            <!-- Loading -->
            <div ng-if="vm.isLoading" style="text-align: center; padding: 50px;">
                <i class="fas fa-spinner fa-spin" style="font-size: 48px; color: #3498db;"></i>
                <p style="margin-top: 20px; color: #7f8c8d;">ƒêang t·∫£i d·ªØ li·ªáu...</p>
            </div>

            <!-- No Orders -->
            <div ng-if="!vm.isLoading && vm.filteredOrders.length === 0" style="text-align: center; padding: 50px;">
                <i class="fas fa-shopping-cart" style="font-size: 64px; color: #bdc3c7;"></i>
                <p style="margin-top: 20px; color: #7f8c8d; font-size: 16px;">Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng n√†o</p>
                <button ng-click="vm.openOrderModal()" class="btn btn-primary" style="margin-top: 15px;">
                    <i class="fas fa-plus"></i> T·∫°o ƒë∆°n ƒë·∫ßu ti√™n
                </button>
            </div>

            <!-- Orders List -->
            <div ng-if="!vm.isLoading && vm.filteredOrders.length > 0" class="content-card">
                <div class="card-content">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <th style="padding: 15px; text-align: left; font-weight: 600;">M√£ ƒë∆°n</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600;">B√†n</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600;">Th·ªùi gian v√†o</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600;">Th·ªùi gian ra</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600;">T·ªïng ti·ªÅn</th>
                                <th style="padding: 15px; text-align: left; font-weight: 600;">Tr·∫°ng th√°i</th>
                                <th style="padding: 15px; text-align: center; font-weight: 600;">Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="order in vm.filteredOrders" style="border-bottom: 1px solid #ecf0f1;">
                                <td style="padding: 15px;">
                                    <strong style="color: #2c3e50;">#{{ order.id }}</strong>
                                </td>
                                <td style="padding: 15px;">
                                    <span ng-if="order.tableName">
                                        <i class="fas fa-table"></i> {{ order.tableName }}
                                    </span>
                                    <span ng-if="!order.tableName" style="color: #95a5a6;">
                                        <i class="fas fa-shopping-bag"></i> Mang ƒëi
                                    </span>
                                </td>
                                <td style="padding: 15px;">
                                    {{ vm.formatDateTime(order.timeIn) }}
                                </td>
                                <td style="padding: 15px;">
                                    <span ng-if="order.timeOut">{{ vm.formatDateTime(order.timeOut) }}</span>
                                    <span ng-if="!order.timeOut" style="color: #95a5a6;">--</span>
                                </td>
                                <td style="padding: 15px;">
                                    <strong style="color: #27ae60;">{{ vm.formatCurrency(order.total) }}</strong>
                                </td>
                                <td style="padding: 15px;">
                                    <span ng-if="order.status === 0" class="badge badge-warning">
                                        ‚è≥ Ch∆∞a thanh to√°n
                                    </span>
                                    <span ng-if="order.status === 1" class="badge badge-success">
                                        ‚úÖ ƒê√£ thanh to√°n
                                    </span>
                                </td>
                                <td style="padding: 15px; text-align: center;">
                                    <button ng-click="vm.viewOrderDetails(order)" class="btn-icon" title="Xem chi ti·∫øt">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button ng-if="order.status === 0" ng-click="vm.payOrder(order)" class="btn-icon" style="color: #27ae60;" title="Thanh to√°n">
                                        <i class="fas fa-credit-card"></i>
                                    </button>
                                    <button ng-if="order.status === 0" ng-click="vm.deleteOrder(order.id)" class="btn-icon" style="color: #e74c3c;" title="X√≥a">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Order Details Modal -->
    <div ng-if="vm.isDetailsModalOpen" class="modal-overlay" ng-click="vm.closeDetailsModal()">
        <div class="modal-dialog" ng-click="$event.stopPropagation()" style="max-width: 700px;">
            <div class="modal-header">
                <h3><i class="fas fa-receipt"></i> Chi ti·∫øt ƒë∆°n h√†ng #{{ vm.selectedOrder.id }}</h3>
                <button ng-click="vm.closeDetailsModal()" class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <!-- Order Info -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                        <div>
                            <strong style="color: #7f8c8d; font-size: 12px;">B√ÄN</strong>
                            <p style="margin: 5px 0 0 0; font-size: 14px;">{{ vm.selectedOrder.tableName || 'Mang ƒëi' }}</p>
                        </div>
                        <div>
                            <strong style="color: #7f8c8d; font-size: 12px;">TR·∫†NG TH√ÅI</strong>
                            <p style="margin: 5px 0 0 0;">
                                <span ng-if="vm.selectedOrder.status === 0" class="badge badge-warning">Ch∆∞a thanh to√°n</span>
                                <span ng-if="vm.selectedOrder.status === 1" class="badge badge-success">ƒê√£ thanh to√°n</span>
                            </p>
                        </div>
                        <div>
                            <strong style="color: #7f8c8d; font-size: 12px;">GI·ªú V√ÄO</strong>
                            <p style="margin: 5px 0 0 0; font-size: 14px;">{{ vm.formatDateTime(vm.selectedOrder.timeIn) }}</p>
                        </div>
                        <div>
                            <strong style="color: #7f8c8d; font-size: 12px;">GI·ªú RA</strong>
                            <p style="margin: 5px 0 0 0; font-size: 14px;">{{ vm.selectedOrder.timeOut ? vm.formatDateTime(vm.selectedOrder.timeOut) : '--' }}</p>
                        </div>
                    </div>
                </div>

                <!-- Order Items -->
                <h4 style="margin-bottom: 15px;">S·∫£n ph·∫©m ƒë√£ ƒë·∫∑t</h4>
                <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                    <thead>
                        <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                            <th style="padding: 12px; text-align: left;">M√≥n</th>
                            <th style="padding: 12px; text-align: center;">SL</th>
                            <th style="padding: 12px; text-align: right;">ƒê∆°n gi√°</th>
                            <th style="padding: 12px; text-align: right;">Th√†nh ti·ªÅn</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="item in vm.selectedOrder.items" style="border-bottom: 1px solid #ecf0f1;">
                            <td style="padding: 12px;">{{ item.productName }}</td>
                            <td style="padding: 12px; text-align: center;">{{ item.quantity }}</td>
                            <td style="padding: 12px; text-align: right;">{{ vm.formatCurrency(item.price) }}</td>
                            <td style="padding: 12px; text-align: right;">{{ vm.formatCurrency(item.quantity * item.price) }}</td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr style="background: #f8f9fa; font-weight: 600;">
                            <td colspan="3" style="padding: 15px; text-align: right;">T·ªîNG C·ªòNG:</td>
                            <td style="padding: 15px; text-align: right; color: #27ae60; font-size: 18px;">
                                {{ vm.formatCurrency(vm.selectedOrder.total) }}
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <div class="modal-footer">
                <button ng-if="vm.selectedOrder.status === 0" ng-click="vm.payOrder(vm.selectedOrder)" class="btn btn-success">
                    <i class="fas fa-credit-card"></i> Thanh to√°n
                </button>
                <button ng-click="vm.closeDetailsModal()" class="btn btn-secondary">
                    <i class="fas fa-times"></i> ƒê√≥ng
                </button>
            </div>
        </div>
    </div>

    <!-- Create Order Modal -->
    <div ng-if="vm.isCreateModalOpen" class="modal-overlay" ng-click="vm.closeCreateModal()">
        <div class="modal-dialog" ng-click="$event.stopPropagation()" style="max-width: 900px;">
            <div class="modal-header">
                <h3><i class="fas fa-plus-circle"></i> T·∫°o ƒë∆°n h√†ng m·ªõi</h3>
                <button ng-click="vm.closeCreateModal()" class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <!-- Table Selection -->
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">
                        Ch·ªçn b√†n <span style="color: #e74c3c;">*</span>
                    </label>
                    <select ng-model="vm.newOrder.tableId" style="width: 100%; padding: 12px; border: 1px solid #ecf0f1; border-radius: 8px;" required>
                        <option value="">-- Vui l√≤ng ch·ªçn b√†n --</option>
                        <option ng-repeat="table in vm.tables" ng-value="table.id">
                            {{ table.name }} - {{ table.status }}
                        </option>
                    </select>
                </div>

                <!-- Product Selection -->
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Ch·ªçn s·∫£n ph·∫©m</label>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; max-height: 300px; overflow-y: auto; padding: 10px; border: 1px solid #ecf0f1; border-radius: 8px;">
                        <div ng-repeat="product in vm.products" 
                             ng-click="vm.addToCart(product)"
                             style="padding: 15px; border: 2px solid #ecf0f1; border-radius: 8px; cursor: pointer; transition: all 0.3s; text-align: center;"
                             ng-mouseenter="$event.currentTarget.style.borderColor='#3498db'; $event.currentTarget.style.background='#f8f9fa'"
                             ng-mouseleave="$event.currentTarget.style.borderColor='#ecf0f1'; $event.currentTarget.style.background='white'">
                            <i class="fas fa-coffee" style="font-size: 32px; color: #3498db; margin-bottom: 10px;"></i>
                            <h5 style="margin: 0 0 5px 0; font-size: 14px;">{{ product.name }}</h5>
                            <p style="margin: 0; color: #27ae60; font-weight: 600;">{{ vm.formatCurrency(product.price) }}</p>
                        </div>
                    </div>
                </div>

                <!-- Cart -->
                <div style="margin-bottom: 25px;">
                    <h4 style="margin-bottom: 15px;">Gi·ªè h√†ng</h4>
                    <div ng-if="vm.cart.length === 0" style="text-align: center; padding: 30px; color: #95a5a6;">
                        <i class="fas fa-shopping-cart" style="font-size: 48px; margin-bottom: 10px;"></i>
                        <p>Ch∆∞a c√≥ s·∫£n ph·∫©m trong gi·ªè h√†ng</p>
                    </div>
                    <table ng-if="vm.cart.length > 0" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f8f9fa;">
                                <th style="padding: 10px; text-align: left;">M√≥n</th>
                                <th style="padding: 10px; text-align: center;">S·ªë l∆∞·ª£ng</th>
                                <th style="padding: 10px; text-align: right;">ƒê∆°n gi√°</th>
                                <th style="padding: 10px; text-align: right;">Th√†nh ti·ªÅn</th>
                                <th style="padding: 10px; text-align: center;"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="item in vm.cart" style="border-bottom: 1px solid #ecf0f1;">
                                <td style="padding: 10px;">{{ item.name }}</td>
                                <td style="padding: 10px; text-align: center;">
                                    <button ng-click="vm.decreaseQuantity(item)" class="btn-icon" style="padding: 5px 10px;">-</button>
                                    <span style="margin: 0 10px; font-weight: 600;">{{ item.quantity }}</span>
                                    <button ng-click="vm.increaseQuantity(item)" class="btn-icon" style="padding: 5px 10px;">+</button>
                                </td>
                                <td style="padding: 10px; text-align: right;">{{ vm.formatCurrency(item.price) }}</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">{{ vm.formatCurrency(item.price * item.quantity) }}</td>
                                <td style="padding: 10px; text-align: center;">
                                    <button ng-click="vm.removeFromCart(item)" class="btn-icon" style="color: #e74c3c;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr style="background: #f8f9fa; font-weight: 600;">
                                <td colspan="3" style="padding: 15px; text-align: right;">T·ªîNG:</td>
                                <td style="padding: 15px; text-align: right; color: #27ae60; font-size: 18px;">
                                    {{ vm.formatCurrency(vm.calculateTotal()) }}
                                </td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>

            <div class="modal-footer">
                <button ng-click="vm.createOrder()" ng-disabled="vm.cart.length === 0" class="btn btn-primary">
                    <i class="fas fa-check"></i> T·∫°o ƒë∆°n h√†ng
                </button>
                <button ng-click="vm.closeCreateModal()" class="btn btn-secondary">
                    <i class="fas fa-times"></i> H·ªßy
                </button>
            </div>
        </div>
    </div>
</div>

