using Models;
using System;
using System.Collections.Generic;
using System.Data;
using System.Data.SqlClient;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace DAL
{
    public class SuppliersDAL
    {
        private readonly DbHelper _dbHelper;

        public SuppliersDAL(DbHelper dbHelper)
        {
            _dbHelper = dbHelper;
        }

        public List<SupplierModel> GetAllSuppliers()
        {
            string sql = "SELECT id, tenNhaCungCap, diaChi, sdt, email FROM NhaCungCap ORDER BY tenNhaCungCap";
            DataTable dt = _dbHelper.ExecuteQuery(sql);

            List<SupplierModel> supplierList = new List<SupplierModel>();
            foreach (DataRow row in dt.Rows)
            {
                supplierList.Add(new SupplierModel
                {
                    Id = Convert.ToInt32(row["id"]),
                    TenNhaCungCap = row["tenNhaCungCap"].ToString() ?? string.Empty,
                    DiaChi = row["diaChi"] == DBNull.Value ? null : row["diaChi"].ToString(),
                    Sdt = row["sdt"] == DBNull.Value ? null : row["sdt"].ToString(),
                    Email = row["email"] == DBNull.Value ? null : row["email"].ToString()
                });
            }
            return supplierList;
        }

        public int CreateSupplier(CreateSupplierRequest request)
        {
            string sql = "INSERT INTO NhaCungCap (tenNhaCungCap, diaChi, sdt, email) VALUES (@tenNhaCungCap, @diaChi, @sdt, @email)";
            SqlParameter[] parameters = {
                new SqlParameter("@tenNhaCungCap", request.TenNhaCungCap),
                new SqlParameter("@diaChi", (object?)request.DiaChi ?? DBNull.Value),
                new SqlParameter("@sdt", (object?)request.Sdt ?? DBNull.Value),
                new SqlParameter("@email", (object?)request.Email ?? DBNull.Value)
            };
            return _dbHelper.ExecuteInsertAndGetId(sql, parameters);
        }
    }

}
