using Microsoft.AspNetCore.Mvc;
using BLL;
using Models;

namespace QuanlyCafe.API.Admin.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class SuppliersController : ControllerBase
    {
        private readonly SuppliersBLL _suppliersBLL;

        public SuppliersController(SuppliersBLL suppliersBLL)
        {
            _suppliersBLL = suppliersBLL;
        }

        // GET: api/suppliers - Lấy danh sách nhà cung cấp
        [HttpGet]
        public IActionResult GetAllSuppliers()
        {
            try
            {
                var supplierList = _suppliersBLL.GetAllSuppliers();
                return Ok(new
                {
                    success = true,
                    message = "Lấy danh sách nhà cung cấp thành công",
                    data = supplierList
                });
            }
            catch (Exception ex)
            {
                return BadRequest(new
                {
                    success = false,
                    message = ex.Message
                });
            }
        }

        // GET: api/suppliers/{id} - Lấy thông tin nhà cung cấp theo ID
        [HttpGet("{id}")]
        public IActionResult GetSupplierById(int id)
        {
            try
            {
                var supplier = _suppliersBLL.GetSupplierById(id);
                if (supplier == null)
                {
                    return NotFound(new
                    {
                        success = false,
                        message = "Không tìm thấy nhà cung cấp"
                    });
                }

                return Ok(new
                {
                    success = true,
                    message = "Lấy thông tin nhà cung cấp thành công",
                    data = supplier
                });
            }
            catch (Exception ex)
            {
                return BadRequest(new
                {
                    success = false,
                    message = ex.Message
                });
            }
        }

        // POST: api/suppliers - Thêm nhà cung cấp mới
        [HttpPost]
        public IActionResult CreateSupplier([FromBody] CreateSupplierRequest request)
        {
            try
            {
                if (request == null)
                {
                    return BadRequest(new
                    {
                        success = false,
                        message = "Dữ liệu không hợp lệ"
                    });
                }

                var newId = _suppliersBLL.CreateSupplier(request);
                return Ok(new
                {
                    success = true,
                    message = "Thêm nhà cung cấp thành công",
                    data = new { id = newId }
                });
            }
            catch (Exception ex)
            {
                return BadRequest(new
                {
                    success = false,
                    message = ex.Message
                });
            }
        }

        // PUT: api/suppliers/{id} - Cập nhật nhà cung cấp
        [HttpPut("{id}")]
        public IActionResult UpdateSupplier(int id, [FromBody] UpdateSupplierRequest request)
        {
            try
            {
                if (request == null)
                {
                    return BadRequest(new
                    {
                        success = false,
                        message = "Dữ liệu không hợp lệ"
                    });
                }

                var result = _suppliersBLL.UpdateSupplier(id, request);
                if (!result)
                {
                    return NotFound(new
                    {
                        success = false,
                        message = "Không thể cập nhật nhà cung cấp"
                    });
                }

                return Ok(new
                {
                    success = true,
                    message = "Cập nhật nhà cung cấp thành công"
                });
            }
            catch (Exception ex)
            {
                return BadRequest(new
                {
                    success = false,
                    message = ex.Message
                });
            }
        }

        // DELETE: api/suppliers/{id} - Xóa nhà cung cấp
        [HttpDelete("{id}")]
        public IActionResult DeleteSupplier(int id)
        {
            try
            {
                var result = _suppliersBLL.DeleteSupplier(id);
                if (!result)
                {
                    return NotFound(new
                    {
                        success = false,
                        message = "Không thể xóa nhà cung cấp"
                    });
                }

                return Ok(new
                {
                    success = true,
                    message = "Xóa nhà cung cấp thành công"
                });
            }
            catch (Exception ex)
            {
                return BadRequest(new
                {
                    success = false,
                    message = ex.Message
                });
            }
        }
    }
}